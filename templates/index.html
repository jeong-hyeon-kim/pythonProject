<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>메인 페이지</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">

    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Noto+Sans+KR:wght@300&display=swap"
          rel="stylesheet">


    <!-- App CSS -->
    <link rel="stylesheet" href="/static/css/style.css" type="text/css">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

    <script type="text/javascript">

        function like(article_id) {
            $.ajax({
                type: 'POST',
                url: '/api/home/like',
                data: {
                    "article_id": article_id
                },
                success: function (response) {
                    // alert(response['message']);
                    // window.location.reload();
                    keyword_search();
                    // $('.like-btn').load(location.href+' .like-btn');
                }
            });
        }

        function keyword_search() {

            let keyword = $('#input_search').val()
            // alert(keyword)
            // let keyword = $('#input_search').value;
            //
            if (keyword) {
                console.log(keyword)
                $('#cards-box').empty()
                $.ajax({
                    type: "GET",
                    url: "api/home/search_article",
                    data: {'keyword': keyword},
                    success: function (response) {
                        let articles = response["found_articles"]

                        for (i = 0; i < articles.length; i++) {
                            console.log(articles[i]['album_title'])
                            let article_id = articles[i]['_id']
                            let writer_id = articles[i]['writer_id']
                            let writer_img = articles[i]['writer_img']
                            let writer_name = articles[i]['writer_name']
                            let title = articles[i]['album_title']
                            let singer = articles[i]['album_singer']
                            let image = articles[i]['album_image']
                            let like = articles[i]['like']
                            let date = articles[i]['post_date']
                            let desc = articles[i]['article_description']
                            let comment1 = articles[i]['comment1']
                            let commenter1_img = articles[i]['commenter1_img']
                            let comment2 = articles[i]['comment2']
                            let commenter2_img = articles[i]['commenter2_img']

                            let temp_html = `<div class="card" style="width: 18rem;">
                                            <img class="card-img-top"
                                                 src="${image}"
                                                 alt="Card image cap">
                                            <div class="card-body">
                                                <span class="title">${title}</span>

                                                <span class="singer">${singer}</span>
                                                <div class="writer-box">
                                                    <img class="writer-img"
                                                         src="${writer_img}">
                                                    <span class="writer-name">${writer_name}</span>
                                                </div>
                                                <div class="description">${desc}</div>
                                                <div class="date">${date}</div>
                                                <span class="article_id__invisible">${article_id}</span>
                                                <div class="comments-wrap">
                                                    <p>댓글</p>
                                                    <div class="comment-box comment-box1">
                                                        <img class="commenter-img"
                                                             src="${commenter1_img}">
                                                        <span class="writer-name">${comment1}</span>
                                                    </div>

                                                    <div class="comment-box comment-box2">
                                                        <img class="commenter-img"
                                                             src="${commenter2_img}" alt="">
                                                        <span class="writer-name">${comment2}</span>
                                                    </div>
                                                </div>
                                                <div class="buttons-box">
                                                    <a href="#" onclick="like('${article_id}')" style="cursor: pointer" class="card-footer-item has-text-info like-btn">
                                                        <i class="fas fa-heart"></i>
                                                        <span class="like-counts">${like}</span>
                                                    </a>

                                                    <a href=# onclick="" class="card-footer-item has-text-info">
                                                        <i class="fas fa-search-plus"></i>
                                                        <span class="like-counts">자세히보기</span>
                                                    </a>
                                                </div>


                                            </div>
                                        </div>`

                            $('#cards-box').append(temp_html)
                        }
                    }
                })
            } else {
                window.location.reload();
            }


        }

    </script>


</head>
<body>


<header id="header">
    <div class="header">

        <div class="header_menu">
            <a href="#" class="myPgBtn">My Page</a>
            <a href="#" class="loginBtn">Login</a>
        </div>

    </div>
</header>

<div class="wrap">

    <div class="logo">
        InAirpod
    </div>

    <div class="wrap-box_search">
        <input type="text" id="input_search" class="input_search" placeholder="검색어를 입력해주세요">
        <button type="button" class="btn btn-search" onclick="keyword_search()">검색</button>
    </div>


    <div class="card-box" id="cards-box">
        {% for result in results %}
        <!-- 이하 44라인정도 하나의 카드-->
        <div class="card" style="width: 18rem;">
            <img class="card-img-top"
                 src="{{ result['album_image'] }}"
                 alt="Card image cap">
            <div class="card-body">
                <span class="title">{{result['album_title']}}</span>

                <span class="singer">{{result['album_singer']}}</span>
                <div class="writer-box">
                    <img class="writer-img"
                         src="{{ result['writer_img'] }}">
                    <span class="writer-name">{{result['writer_name']}}</span>
                </div>
                <div class="description">{{ result['article_description'] }}</div>
                <div class="date">{{result['post_date']}}</div>
                <span class="article_id__invisible">{{result['_id']}}</span>
                <div class="comments-wrap">
                    <p>댓글</p>
                    <div class="comment-box comment-box1">
                        {% if result['comment1'] %}
                        <img class="commenter-img"
                             src="{{result['commenter1_img']}}">
                        {% else %}
                        <img class="commenter-img"
                             src="https://mblogthumb-phinf.pstatic.net/MjAxNzEyMThfMjQ1/MDAxNTEzNjA3MTcwNTg4.f9D3x971p8iDr_ox3nOQZmp2bHHA3YEtAvWI6-Zq6aAg.1E7HSp02TKDPZwC1wdciQdKiMEEzo0TvuY0ts5OmK4Mg.PNG.ooza-/IMG_9198.PNG?type=w800">
                        {% endif %}

                        <span class="writer-name">{{result['comment1']}}</span>
                    </div>

                    <div class="comment-box comment-box2">
                        {% if result['comment2'] %}
                        <img class="commenter-img"
                             src="{{result['commenter2_img']}}">
                        {% else %}
                        <img class="commenter-img"
                             src="https://mblogthumb-phinf.pstatic.net/MjAxNzEyMThfMjQ1/MDAxNTEzNjA3MTcwNTg4.f9D3x971p8iDr_ox3nOQZmp2bHHA3YEtAvWI6-Zq6aAg.1E7HSp02TKDPZwC1wdciQdKiMEEzo0TvuY0ts5OmK4Mg.PNG.ooza-/IMG_9198.PNG?type=w800">
                        {% endif %}

                        <span class="writer-name">{{result['comment2']}}</span>
                    </div>
                </div>
                <div class="buttons-box">
                    <a href="#" onclick=like("{{result['_id']}}") style="cursor: pointer"
                       class="card-footer-item has-text-info like-btn">
                        <i class="fas fa-heart"></i>
                        <span class="like-counts">{{result['like']}}</span>
                    </a>

                    <a href="#" onclick="" class="card-footer-item has-text-info">
                        <i class="fas fa-search-plus"></i>
                        <span class="like-counts">자세히보기</span>
                    </a>
                </div>


            </div>
        </div>
        {% endfor %}

    </div>


</div>


</body>
</html>